<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—Ö–º–∞—Ç—ã —Å –ø–∞–ø–æ–π –æ–Ω–ª–∞–π–Ω</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        h1 { color: white; margin: 10px 0; font-size: 24px; text-align: center; }
        .dad-message {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .room-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: center;
            max-width: 100%;
        }
        .room-code {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        button {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .status {
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0;
            border: 3px solid #333;
            border-radius: 5px;
            max-width: 100vw;
            aspect-ratio: 1;
            width: 100%;
            max-width: 400px;
        }
        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(24px, 8vw, 40px);
            cursor: pointer;
            user-select: none;
        }
        .white { background: #f0d9b5; }
        .black { background: #b58863; }
        .selected { background: #7b61ff !important; }
        .valid-move { background: #90EE90 !important; }
        input {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 2px solid #ddd;
            margin: 5px;
            text-align: center;
        }
        @media (max-width: 400px) {
            .cell { font-size: 28px; }
            .dad-message { font-size: 18px; padding: 15px 20px; }
        }
    </style>
</head>
<body>
    <h1>‚ôüÔ∏è –®–ê–•–ú–ê–¢–´ –° –ü–ê–ü–û–ô ‚ôüÔ∏è</h1>
    <div class="dad-message">‚ù§Ô∏è –ü–∞–ø, –¥–∞–≤–∞–π —Å—ã–≥—Ä–∞–µ–º –≤ —à–∞—Ö–º–∞—Ç—ã! ‚ù§Ô∏è</div>
    
    <div class="room-info" id="roomSection">
        <h3>–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</h3>
        <button onclick="createRoom()">üéÆ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
        <br><br>
        <input type="text" id="roomInput" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã" maxlength="6">
        <button onclick="joinRoom()">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
    </div>
    
    <div class="status" id="status">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    <div class="board" id="board"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <script>
        // ‚úÖ –í–∞—à Firebase –∫–æ–Ω—Ñ–∏–≥ ‚Äî —É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω!
        const firebaseConfig = {
            apiKey: "AIzaSyALZnPwbUASl4wBa5q8XWKnH7k7JFUxDPc",
            authDomain: "chess-with-dad.firebaseapp.com",
            databaseURL: "https://chess-with-dad-default-rtdb.firebaseio.com",
            projectId: "chess-with-dad",
            storageBucket: "chess-with-dad.firebasestorage.app",
            messagingSenderId: "1065127986870",
            appId: "1:1065127986870:web:67656d8d6d3859a1348817"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let roomId = null;
        let playerColor = null;
        let board = [];
        let selectedCell = null;
        let currentTurn = 'white';
        let gameStarted = false;
        
        const pieces = {
            'K': '‚ôî', 'Q': '‚ôï', 'R': '‚ôñ', 'B': '‚ôó', 'N': '‚ôò', 'P': '‚ôô',
            'k': '‚ôö', 'q': '‚ôõ', 'r': '‚ôú', 'b': '‚ôù', 'n': '‚ôû', 'p': '‚ôü'
        };
        
        const initialBoard = [
            ['r','n','b','q','k','b','n','r'],
            ['p','p','p','p','p','p','p','p'],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['P','P','P','P','P','P','P','P'],
            ['R','N','B','Q','K','B','N','R']
        ];
        
        // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
        function createRoom() {
            roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
            playerColor = 'white';
            
            database.ref('rooms/' + roomId).set({
                board: JSON.parse(JSON.stringify(initialBoard)),
                currentTurn: 'white',
                players: { white: 'host', black: null },
                createdAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            document.getElementById('roomSection').innerHTML = `
                <h3>‚úÖ –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!</h3>
                <div class="room-code">üîë –ö–æ–¥: ${roomId}</div>
                <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –ø–∞–ø–µ üëá</p>
                <p><small>–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</small></p>
            `;
            gameStarted = true;
            listenToGame();
        }
        
        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const code = document.getElementById('roomInput').value.trim().toUpperCase();
            if (!code) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã!'); return; }
            
            roomId = code;
            playerColor = 'black';
            
            database.ref('rooms/' + roomId + '/players/black').set('joined')
                .then(() => {
                    database.ref('rooms/' + roomId + '/players/white').set('host');
                    document.getElementById('roomSection').innerHTML = `
                        <h3>‚úÖ –í—ã –≤ –∏–≥—Ä–µ!</h3>
                        <div class="room-code">üîë –ö–æ–º–Ω–∞—Ç–∞: ${roomId}</div>
                        <p>–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ ‚ö´ —á—ë—Ä–Ω—ã—Ö</p>
                    `;
                    gameStarted = true;
                    listenToGame();
                })
                .catch(() => {
                    alert('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥.');
                });
        }
        
        // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–≥—Ä–µ
        function listenToGame() {
            database.ref('rooms/' + roomId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.board) {
                    board = data.board;
                    currentTurn = data.currentTurn;
                    renderBoard();
                    updateStatus();
                }
            });
        }
        
        // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        function makeMove(fromRow, fromCol, toRow, toCol) {
            if (!gameStarted || !roomId) return;
            if ((playerColor === 'white' && currentTurn !== 'white') ||
                (playerColor === 'black' && currentTurn !== 'black')) {
                return;
            }
            
            const piece = board[fromRow][fromCol];
            if (!piece) return;
            
            const newBoard = board.map(row => [...row]);
            newBoard[toRow][toCol] = newBoard[fromRow][fromCol];
            newBoard[fromRow][fromCol] = '';
            
            // –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—à–∫–∏
            if (newBoard[toRow][toCol] === 'P' && toRow === 0) newBoard[toRow][toCol] = 'Q';
            if (newBoard[toRow][toCol] === 'p' && toRow === 7) newBoard[toRow][toCol] = 'q';
            
            const nextTurn = currentTurn === 'white' ? 'black' : 'white';
            
            database.ref('rooms/' + roomId).update({
                board: newBoard,
                currentTurn: nextTurn
            });
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –¥–æ—Å–∫—É
        function renderBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell ' + ((row + col) % 2 === 0 ? 'white' : 'black');
                    
                    if (board[row] && board[row][col]) {
                        cell.textContent = pieces[board[row][col]];
                    }
                    
                    if (selectedCell && selectedCell.row === row && selectedCell.col === col) {
                        cell.classList.add('selected');
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    boardEl.appendChild(cell);
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        function handleCellClick(row, col) {
            if (!gameStarted || !roomId) return;
            
            const piece = board[row] ? board[row][col] : null;
            if (!piece) {
                if (selectedCell) {
                    makeMove(selectedCell.row, selectedCell.col, row, col);
                    selectedCell = null;
                    renderBoard();
                }
                return;
            }
            
            const isWhitePiece = piece === piece.toUpperCase();
            
            if (!selectedCell) {
                if ((playerColor === 'white' && isWhitePiece && currentTurn === 'white') ||
                    (playerColor === 'black' && !isWhitePiece && currentTurn === 'black')) {
                    selectedCell = { row, col };
                    renderBoard();
                }
            } else {
                makeMove(selectedCell.row, selectedCell.col, row, col);
                selectedCell = null;
                renderBoard();
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        function updateStatus() {
            const statusEl = document.getElementById('status');
            const isMyTurn = (playerColor === 'white' && currentTurn === 'white') ||
                           (playerColor === 'black' && currentTurn === 'black');
            
            if (isMyTurn) {
                statusEl.textContent = 'üü¢ –í–∞—à —Ö–æ–¥!';
                statusEl.style.background = '#90EE90';
            } else {
                statusEl.textContent = '‚è≥ –•–æ–¥ –ø–∞–ø—ã...';
                statusEl.style.background = '#FFB6C1';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initBoard() {
            board = JSON.parse(JSON.stringify(initialBoard));
            renderBoard();
        }
        
        initBoard();
    </script>
</body>
</html>